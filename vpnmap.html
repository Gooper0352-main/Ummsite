<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VPN Map Viewer</title>
<style>
  body { margin: 0; background: black; color: white; font-family: Arial; }
  header { text-align: center; padding: 10px; }
  #controls { text-align: center; margin: 10px; }
  #controls button {
      margin: 5px;
      padding: 10px 20px;
      background: #444;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
  }
  #controls button:hover { background: #666; }
  #pdf-container {
      width: 100vw;
      height: calc(100vh - 100px);
      overflow: hidden;
      position: relative;
      cursor: grab;
  }
  canvas {
      position: absolute;
      top: 0;
      left: 0;
      transform-origin: 0 0;
  }
  canvas:active { cursor: grabbing; }

  #loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      font-size: 18px;
  }
  #progress-bar {
      width: 60%;
      height: 20px;
      background: #333;
      border-radius: 10px;
      margin-top: 10px;
      overflow: hidden;
  }
  #progress-fill {
      width: 0%;
      height: 100%;
      background: #00ffcc;
      transition: width 0.2s;
  }
  #status-text {
      margin-top: 8px;
      font-size: 14px;
      color: #ccc;
  }
</style>
</head>
<body>
<header><h1>VPN Map (Who Owns Who)</h1></header>
<div id="controls">
    <button onclick="zoomIn()">Zoom In</button>
    <button onclick="zoomOut()">Zoom Out</button>
    <button onclick="resetView()">Reset</button>
</div>
<div id="pdf-container">
    <canvas id="canvas-low"></canvas>
    <canvas id="canvas-high"></canvas>
    <div id="loading-overlay">
        <div>Loading VPN Map... <span id="progress-text">0%</span></div>
        <div id="progress-bar"><div id="progress-fill"></div></div>
        <div id="status-text">Downloading...</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
<script>
const url = 'https://raw.githubusercontent.com/Gooper0352-main/Ummsite/main/vpnmap.pdf';

let pdfDoc = null, pageNum = 1;
let zoom = 1, panX = 0, panY = 0;
const lowCanvas = document.getElementById('canvas-low');
const lowCtx = lowCanvas.getContext('2d');
const highCanvas = document.getElementById('canvas-high');
const highCtx = highCanvas.getContext('2d');
const container = document.getElementById('pdf-container');
const loadingOverlay = document.getElementById('loading-overlay');
const progressFill = document.getElementById('progress-fill');
const progressText = document.getElementById('progress-text');
const statusText = document.getElementById('status-text');

// PDF download progress
const loadingTask = pdfjsLib.getDocument({ url: url, rangeChunkSize: 65536 });
loadingTask.onProgress = function(progressData){
    let percent = Math.floor((progressData.loaded / progressData.total) * 100);
    progressFill.style.width = percent + '%';
    progressText.textContent = percent + '%';
};
loadingTask.promise.then(pdf => {
    pdfDoc = pdf;
    renderLowRes(); // show fast preview
}).catch(err => console.error(err));

// Low-res render
function renderLowRes(){
    pdfDoc.getPage(pageNum).then(page => {
        const viewport = page.getViewport({ scale: 0.3 });
        lowCanvas.width = viewport.width;
        lowCanvas.height = viewport.height;
        highCanvas.width = viewport.width;
        highCanvas.height = viewport.height;

        page.render({ canvasContext: lowCtx, viewport }).promise.then(()=>{
            hideLoading(); // hide overlay immediately
            statusText.textContent = 'Rendering high-res...';
            renderHighRes(); // start high-res in background
        });
    });
}

// High-res render (progressive, replaces low-res visually)
function renderHighRes(){
    pdfDoc.getPage(pageNum).then(page=>{
        const viewport = page.getViewport({ scale: 1 });
        highCanvas.width = viewport.width;
        highCanvas.height = viewport.height;
        page.render({ canvasContext: highCtx, viewport }).promise.then(()=>{
            statusText.textContent = ''; // done
        });
    });
}

function hideLoading(){ loadingOverlay.style.display='none'; }

// Apply zoom & pan to both canvases
function applyTransform(){
    const transform = `translate(${panX}px, ${panY}px) scale(${zoom})`;
    lowCanvas.style.transform = transform;
    highCanvas.style.transform = transform;
}

function zoomIn(){ zoom+=0.2; applyTransform(); }
function zoomOut(){ zoom = Math.max(0.2, zoom-0.2); applyTransform(); }
function resetView(){ zoom=1; panX=0; panY=0; applyTransform(); }

// Drag to pan
let isDragging=false, startX, startY;
container.addEventListener('mousedown', e=>{
    isDragging=true;
    startX = e.clientX - panX;
    startY = e.clientY - panY;
});
container.addEventListener('mousemove', e=>{
    if(!isDragging) return;
    panX = e.clientX - startX;
    panY = e.clientY - startY;
    applyTransform();
});
window.addEventListener('mouseup', ()=> isDragging=false);

// Scroll wheel to zoom
container.addEventListener('wheel', e=>{
    e.preventDefault();
    const zoomFactor = 1.1;
    const mouseX = e.clientX - container.offsetLeft;
    const mouseY = e.clientY - container.offsetTop;

    if(e.deltaY < 0){
        zoom *= zoomFactor;
        panX = mouseX - (mouseX - panX) * zoomFactor;
        panY = mouseY - (mouseY - panY) * zoomFactor;
    }else{
        zoom /= zoomFactor;
        zoom = Math.max(0.2, zoom);
        panX = mouseX - (mouseX - panX) / zoomFactor;
        panY = mouseY - (mouseY - panY) / zoomFactor;
    }
    applyTransform();
},{passive:false});
</script>
</body>
</html>
