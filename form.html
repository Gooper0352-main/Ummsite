<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Apply — Sony Tracker</title>
  <style>
    :root{--gov-blue:#1d70b8;--gov-dark:#0b2d5a;--muted:#6b6b6b}
    body{font-family:Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#f3f2f1;color:#0b2d5a;margin:0;padding:32px}
    .container{max-width:760px;margin:0 auto;background:#fff;padding:32px;border-radius:6px;box-shadow:0 2px 6px rgba(13,20,25,0.06)}
    h1{color:var(--gov-dark);font-size:28px;margin:0 0 8px}
    p.lead{margin:0 0 24px;color:var(--muted)}
    label{display:block;font-weight:600;margin-top:18px}
    input[type=text],input[type=email],input[type=tel],textarea,select{width:100%;padding:10px;border:1px solid #dfe1e5;border-radius:4px;font-size:15px}
    textarea{min-height:120px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    .actions{margin-top:20px}
    button{background:var(--gov-blue);color:#fff;border:0;padding:10px 16px;border-radius:4px;font-size:16px;cursor:pointer}
    button.secondary{background:#f3f2f1;color:#0b2d5a}
    .notice{border-left:4px solid #ffd200;background:#fff8d6;padding:12px;margin:12px 0;border-radius:3px}
    .success{border-left-color:#28a745;background:#eafbea}
    .error{border-left-color:#d9534f;background:#ffecec}
    small.error-text{color:#d9534f}
    footer{font-size:13px;color:#6b6b6b;margin-top:24px}
  </style>
</head>
<body>
  <div class="container">
    <a href="#" style="color:var(--gov-blue);text-decoration:none;font-weight:600">Home</a>
    <h1>Apply to work at Sony Tracker</h1>
    <p class="lead">Complete this form to apply for a role at Sony Tracker. Fields marked with * are required.</p>

    <div id="messages"></div>

    <form id="application" autocomplete="off">
      <div class="row">
        <div>
          <label for="firstName">First name *</label>
          <input id="firstName" name="firstName" type="text" required>
        </div>
        <div>
          <label for="lastName">Last name *</label>
          <input id="lastName" name="lastName" type="text" required>
        </div>
      </div>

      <div class="row">
        <div>
          <label for="email">Email address *</label>
          <input id="email" name="email" type="email" required>
        </div>
        <div>
          <label for="phone">Phone number</label>
          <input id="phone" name="phone" type="tel" placeholder="+44 7123 456789">
        </div>
      </div>

      <label for="role">Role applying for *</label>
      <select id="role" name="role" required>
        <option value="">Select a role</option>
        <option>Lower - £22/h</option>
        <option>Higher - £32/h</option>
      </select>

      <label for="location">Location (city)</label>
      <input id="location" name="location" type="text">

      <label for="experience">Relevant experience *</label>
      <textarea id="experience" name="experience" required placeholder="Describe your experience, skills and why you think you're a good fit"></textarea>

      <label for="cv">Upload CV (optional)</label>
      <input id="cv" name="cv" type="file" accept="application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
      <div class="hint">If you choose to upload a file it will be attached and encoded before sending to the webhook.</div>

      <label class="full" for="consent">Can we contact referees if successful?</label>
      <select id="consent" name="consent">
        <option>Yes</option>
        <option>No</option>
      </select>

      <div class="actions">
        <button type="submit">Submit application</button>
        <button type="button" class="secondary" id="clearBtn">Clear</button>
      </div>

    </form>

    <footer>
      <small>Note: This posts application details to a Discord webhook. Ensure you do not share sensitive data publicly.</small>
    </footer>
  </div>

  <script>
    const WEBHOOK_URL = 'https://discord.com/api/webhooks/1404172861450747915/aPjS-VZdaPCa3s8KeX5_cxhaRiO2w_F5HrsoHnuuGLFc8Xbw33T1DhWH3mv_gcNRt5qS';

    const form = document.getElementById('application');
    const messages = document.getElementById('messages');
    const clearBtn = document.getElementById('clearBtn');

    function showMessage(text, type='info'){
      messages.innerHTML = `<div class="notice ${type==='success'?'success':type==='error'?'error':''}"><strong>${type==='success'?'Success':'Notice'}</strong> — <span>${text}</span></div>`;
    }

    function clearMessages(){ messages.innerHTML = ''; }

    clearBtn.addEventListener('click', ()=>{ form.reset(); clearMessages(); });

    async function fileToBase64(file){
      return new Promise((resolve,reject)=>{
        if(!file) return resolve(null);
        const reader = new FileReader();
        reader.onload = ()=> resolve(reader.result.split(',')[1]);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      clearMessages();
      const formData = new FormData(form);
      const firstName = formData.get('firstName')?.trim();
      const lastName = formData.get('lastName')?.trim();
      const email = formData.get('email')?.trim();
      const role = formData.get('role')?.trim();
      const experience = formData.get('experience')?.trim();

      if(!firstName || !lastName || !email || !role || !experience){
        showMessage('Please complete all required fields (marked with *).', 'error');
        return;
      }

      const payload = {
        content: `**New Sony Tracker Application**\n**Name:** ${firstName} ${lastName}\n**Email:** ${email}\n**Phone:** ${formData.get('phone') || 'N/A'}\n**Location:** ${formData.get('location') || 'N/A'}\n**Role:** ${role}\n**Consent to referees:** ${formData.get('consent')}\n**Experience:** ${experience}`
      };

      const cvInput = document.getElementById('cv');
      if(cvInput && cvInput.files && cvInput.files[0]){
        try{
          const file = cvInput.files[0];
          const base64 = await fileToBase64(file);
          payload.content += `\n**CV:** ${file.name} (base64 attached)`;
          payload.files = [{name:file.name, content:base64}];
        }catch(err){
          console.error('File read error', err);
          showMessage('Could not read the uploaded file. Try again.', 'error');
          return;
        }
      }

      try{
        const resp = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if(resp.ok){
          showMessage('Your application was submitted successfully. Thank you!', 'success');
          form.reset();
        }else{
          const text = await resp.text().catch(()=>resp.statusText);
          console.error('Webhook error', resp.status, text);
          showMessage('Failed to submit application. Server returned '+resp.status+': '+text, 'error');
        }
      }catch(err){
        console.error('Network error', err);
        showMessage('Network error while sending application — check your webhook URL and network connectivity.', 'error');
      }
    });
  </script>
</body>
</html>
